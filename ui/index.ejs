<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aplicación Contenedora</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Lucide (iconos) -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js" defer></script>
</head>

<body>
  <div class="min-h-screen bg-background text-foreground">
    <!-- Header -->
    <header class="header">
      <div class="header__left">
        <h1 class="header__title">Aplicaciones</h1>
      </div>
      <div class="header__right">
        <button id="toggleTheme" class="btn btn-ghost btn-icon rounded-full muted-50" aria-label="Cambiar tema">
          <span id="themeIcon" class="icon-20"></span>
        </button>
        <button class="btn btn-ghost btn-icon rounded-full primary-20" aria-label="Usuario">
          <i data-lucide="user" class="icon-20 primary"></i>
        </button>
      </div>
    </header>

    <div class="layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <% if (typeof modules !=='undefined' ) { %>
          <% modules.forEach(m=> { %>
            <a href="/modulos/<%= m.slug %>" data-slug="<%= m.slug %>" class="avatar avatar-modulo primary-20"
              target="_blank">
              <span class="avatar__text"><%= m.slug[0].toUpperCase() %><%= m.slug[1].toUpperCase()%></span>
            </a>
            <% }) %>
              <% } %>

                <!-- <div class="avatar secondary-20">
          <div class="mini-card secondary"></div>
        </div>

        <div class="avatar accent-20">
          <i data-lucide="check" class="icon-24 accent"></i>
        </div> -->

                <button class="avatar dashed primary-20" aria-label="Agregar">
                  <i data-lucide="plus" class="icon-24 primary"></i>
                </button>
      </aside>

      <!-- Main -->
      <main class="main">
        <!-- SHELL (interfaz por encima del módulo) -->
  <div id="moduleShell" class="mod-shell" role="dialog" aria-modal="true" aria-label="Módulo">
    <header class="mod-shell__topbar">
      <div class="mod-shell__brand" aria-hidden="true"></div>
      <div class="mod-shell__title">Módulo: <span id="modTitle">—</span></div>
      <div class="mod-shell__muted" id="modStatus">· cargando…</div>
      <div class="mod-shell__spacer"></div>

      <a id="openNewTab" class="mod-shell__btn" target="_blank" rel="noopener noreferrer">
        <i data-lucide="external-link" class="icon-16"></i>
        <span class="mod-shell__btn-text">Abrir pestaña</span>
      </a>
      <button id="reloadFrame" class="mod-shell__btn mod-shell__btn--ghost">
        <i data-lucide="refresh-cw" class="icon-16"></i>
        <span class="mod-shell__btn-text">Recargar</span>
      </button>
      <button id="closeShell" class="mod-shell__btn mod-shell__btn--ghost" aria-label="Cerrar">
        <i data-lucide="x" class="icon-16"></i>
        <span class="mod-shell__btn-text">Cerrar</span>
      </button>
    </header>

    <div class="mod-shell__framewrap">
      <iframe id="modFrame" class="mod-shell__frame" src="about:blank" allow="clipboard-read; clipboard-write"></iframe>
    </div>
  </div>
  
        <!-- Search bar -->
        <div class="toolbar">
          <div class="search">
            <i data-lucide="search" class="icon-16 muted absolute-left"></i>
            <input id="searchInput" type="text" placeholder="Buscar aplicación" class="input pl-10" />
          </div>
          <button class="btn btn-primary btn-icon rounded-12" aria-label="Nuevo">
            <i data-lucide="plus" class="icon-16"></i>
          </button>
        </div>

        <!-- Grid -->
        <% if (typeof modules !=='undefined' && modules.length> 0) { %>
          <div class="grid" id="grid-modules">
          <% modules.forEach(m=> { %>
            
              <!-- Calendario -->

              <article class="card" data-slug="<%= m.slug %>">
                <div class="card__content">
                  <div class="tile secondary-30">
                    <i data-lucide="calendar" class="icon-32 secondary"></i>
                  </div>

                  <div>
                    <h3 class="card__title">
                      <%= m.name %>
                    </h3>
                    <p class="muted small">
                      <%= m.description %>
                    </p>
                  </div>

                  <!-- Acciones -->
                  <div class="card__kebab">
                    <button class="kebab-btn" aria-haspopup="menu" aria-expanded="false" aria-label="Más acciones"
                      data-menu-for="<%= m.slug %>">
                      <i data-lucide="more-vertical" class="icon-16"></i>
                    </button>

                    <div class="dropdown-menu" role="menu" id="menu-<%= m.slug %>" hidden>
                      <button class="dropdown-item danger delete-module" role="menuitem" data-slug="<%= m.slug %>">
                        <i data-lucide="trash-2" class="icon-16"></i>
                        Eliminar módulo
                      </button>
                    </div>
                  </div>

                  <!-- Fallback / Abrir -->
                  <a href="/apps/<%= m.slug %>" class="btn chip secondary-50 open-module"
                    data-slug="<%= m.slug %>">Abrir</a>
                </div>
              </article>
              <% }) %>

            </div>
            <%} else {%>

              <div class="module-empty">
                <div>
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                    id="Layer_1" x="0px" y="0px" viewBox="0 0 398.3 415.1"
                    style="enable-background:new 0 0 398.3 415.1;" xml:space="preserve">
                    <style type="text/css">
                      .st0 {
                        fill: #E0E0E0;
                      }

                      .st1 {
                        fill: #FAFAFA;
                      }

                      .st2 {
                        fill: #F5F5F5;
                      }

                      .st3 {
                        fill: #EBEBEB;
                      }

                      .st4 {
                        fill: #455A64;
                      }

                      .st5 {
                        fill: #263238;
                      }

                      .st6 {
                        fill: var(--primary);
                      }

                      .st7 {
                        fill: #FFBE9D;
                      }

                      .st8 {
                        fill: #EB996E;
                      }

                      .st9 {
                        opacity: 0.3;
                      }

                      .st10 {
                        opacity: 0.3;
                        enable-background: new;
                      }
                    </style>
                    <g id="background-complete--inject-433">
                      <rect x="36.6" y="10.3" class="st0" width="159.9" height="200.9" />
                      <rect x="42.4" y="16" class="st1" width="149.2" height="189.4" />
                      <polygon class="st2"
                        points="42.4,155.5 72.5,155.5 76.3,173.1 89.4,173.1 100.5,122.9 137.6,122.9 137.6,88.6 164.6,88.6    164.6,145.9 191.7,145.9 191.7,205.5 42.4,205.5  " />
                      <rect x="114.6" y="16" class="st0" width="4.8" height="187.9" />
                      <rect x="42.4" y="107.8" class="st0" width="149.2" height="4.9" />
                      <polygon class="st0" points="348.4,63.8 358,88.4 352,88.4 347.2,73.3  " />
                      <polygon class="st3" points="315.6,41.1 312.3,88.2 346.4,88.9 350.2,41.1  " />
                      <polygon class="st1" points="319,44.9 316.3,84.1 341.6,85.3 345.1,44.7  " />
                      <polygon class="st0" points="324.6,50.5 322.5,78 336.5,78 338.9,50.5  " />
                      <polygon class="st3" points="265,88.6 265,49.9 293.3,49.9 293.3,88.5  " />
                      <path class="st0"
                        d="M281.1,49.9c0,0,6.8-49.9,4.9-49.9s-6.7,45.5-6.7,45.5s-0.2-37.7-2-37.5s0,39.9,0,39.9s-3.1-32.2-4.7-31.4   c-1.7,0.8,0.7,33.3,0.7,33.3H281.1" />
                      <path class="st3"
                        d="M276,49.9c0,0,2.4-24.9,3.1-23.2s0,14.8,0,14.8s6.6-32.1,8.3-31.1s-6.7,34.9-6.7,34.9s6.4-19.3,7.8-17.3   s-5.3,20.1-5.3,20.1s6.9-12.8,7.3-11.1s-3.3,12.7-3.3,12.7L276,49.9z" />
                      <path class="st3"
                        d="M271.9,50c0,0-15.1-29.7-13.3-28.8s11.6,20.1,11.6,20.1s-6.4-18.5-5-19.1s8.4,20.8,8.4,20.8l1.6,7L271.9,50z" />
                      <polygon class="st0" points="278.1,49.9 278.8,88.6 265.4,88.6 265.1,49.8  " />
                      <polygon class="st2" points="265,53.3 278.1,53.5 293.3,53.3 293.8,49.6 264.7,49.6  " />
                      <rect x="240.7" y="87.9" class="st0" width="141.7" height="6.2" />
                    </g>
                    <g id="Device--inject-433">
                      <path class="st4"
                        d="M267.2,312.1c-1.2-1.3,1.6-9.1,15.1-9.6s18.8,4.3,18.8,9.6C301.1,314.4,267.2,312.1,267.2,312.1z" />
                      <polygon class="st2" points="260.6,108.8 245.7,201.1 381.9,201.1 398.3,107.8  " />
                      <path class="st0" d="M259.2,117.2c0.1-0.3,137.6-0.5,137.6-0.5l1.6-8.9l-137.8,1L259.2,117.2" />
                      <path class="st5"
                        d="M266.3,112.9c0,0.7-0.6,1.3-1.3,1.3s-1.3-0.6-1.3-1.3c0-0.7,0.6-1.3,1.3-1.3c0,0,0,0,0,0   C265.8,111.7,266.3,112.2,266.3,112.9C266.3,112.9,266.3,112.9,266.3,112.9z" />
                      <path class="st5"
                        d="M272.5,112.9c0,0.7-0.6,1.3-1.3,1.3c-0.7,0-1.3-0.6-1.3-1.3s0.6-1.3,1.3-1.3S272.5,112.2,272.5,112.9   L272.5,112.9z" />
                      <path class="st5"
                        d="M278.7,112.9c0,0.7-0.6,1.3-1.3,1.3s-1.3-0.6-1.3-1.3c0-0.7,0.6-1.3,1.3-1.3c0,0,0,0,0,0   C278.2,111.7,278.7,112.2,278.7,112.9C278.7,112.9,278.7,112.9,278.7,112.9z" />
                      <path class="st6"
                        d="M294.1,158.6l-17.1,19.7c-6.5-4.4-10.5-11.8-10.6-19.7c0-13.7,12.5-25,27.7-25s27.7,11.3,27.7,25L294.1,158.6z   " />
                      <path class="st5"
                        d="M296.3,161.8c-0.1,0.1-0.2,0.3-0.3,0.4l-0.9,1.1l-3.4,4c-2.9,3.4-7.1,8.3-12.1,14.1V181   c3.8,2.6,8.1,4.2,12.7,4.7c5.1,0.6,10.4-0.2,15.1-2.3c4.5-2,8.4-5.1,11.3-9.1c1.3-1.9,2.3-3.9,3.1-6.1c0.7-2,1.1-4.1,1.2-6.2   l0.2,0.2l-19.5-0.3l-5.5-0.1l-1.5-0.1C296.6,161.9,296.5,161.9,296.3,161.8c0.1,0.1,0.3,0.1,0.5,0.1h1.4h5.5l19.6,0.1h0.2v0.2   c-0.1,2.2-0.5,4.3-1.2,6.3c-0.8,2.2-1.8,4.3-3.1,6.2c-2.9,4.1-6.9,7.4-11.6,9.4c-4.8,2.1-10.1,2.9-15.4,2.3   c-4.6-0.5-9.1-2.2-12.9-4.9l-0.2-0.1l0.2-0.2l12.3-14.1l3.5-3.9l0.9-1C296.1,162.1,296.2,161.9,296.3,161.8z" />
                      <circle class="st5" cx="305.9" cy="143.8" r="1.5" />
                      <path class="st5"
                        d="M338.2,132.4c-0.5,0.1-1,0.1-1.5,0.1l-4,0.1c-3.4,0-8,0.1-13.1,0.1h-2.4l0.2-0.1c-3.2,3.2-6.1,6-8.1,8   l-2.5,2.3c-0.3,0.3-0.6,0.6-0.9,0.8c0.2-0.3,0.5-0.6,0.8-0.9c0.6-0.6,1.4-1.5,2.3-2.4c2-2.1,4.8-4.9,8-8.1l0.1-0.1h2.6   c5.1,0,9.7,0,13.1,0.1l4,0.1C337.3,132.3,337.8,132.4,338.2,132.4z" />
                      <path class="st5"
                        d="M373.3,151.9c0-0.2,0-0.4,0.1-0.5c0.1-0.4,0.1-0.9,0.2-1.5l1-5.6l3.6-20.1l0.2,0.2l-38.7,0.1l0.2-0.2l0,0v0.1   v0.1v0.2l-0.1,0.5l-0.2,0.9l-0.3,1.8c-0.2,1.2-0.5,2.4-0.7,3.6c-0.4,2.4-0.9,4.8-1.3,7.1c-0.9,4.6-1.7,9-2.5,13.2l-0.2-0.3   l27.9,0.1l8,0.1h2.1L373.3,151.9l0.1-0.1L373.3,151.9l-0.6-0.1h-2.1l-7.9,0.1l-28,0.1h-0.3l0-0.3c0.8-4.2,1.6-8.6,2.4-13.2   c0.4-2.3,0.9-4.7,1.3-7.1c0.2-1.2,0.5-2.4,0.7-3.6c0.1-0.6,0.2-1.2,0.3-1.8l0.2-0.9l0.1-0.5l0-0.2v-0.1v-0.1l0,0l0.3-0.2l38.7,0.1   h0.1l0,0.2c-1.6,8.4-2.9,15.3-3.8,20.1c-0.5,2.4-0.8,4.2-1.1,5.5l-0.3,1.4C373.4,151.8,373.3,151.9,373.3,151.9z" />
                      <circle class="st5" cx="308.3" cy="175" r="1.5" />
                      <path class="st5"
                        d="M336.5,175c0,0.1-6.3,0.3-14.1,0.3s-14.1-0.1-14.1-0.3s6.3-0.3,14.1-0.3S336.5,174.8,336.5,175z" />
                      <path class="st5"
                        d="M373.3,187c0-0.1,0-0.3,0.1-0.4c0.1-0.3,0.1-0.6,0.2-1.1c0.2-1,0.6-2.3,1-4.1c0.9-3.5,2.1-8.6,3.6-14.8   l0.2,0.2l-39.9,0.1l0.2-0.2l0,0v0.1v0.1v0.2l-0.1,0.3l-0.2,0.7l-0.3,1.3c-0.2,0.9-0.5,1.8-0.7,2.6l-1.4,5.2   c-0.9,3.4-1.7,6.7-2.5,9.8l-0.2-0.3l28.6,0.1l8.3,0.1h2.2h0.6L373.3,187l-0.2,0h-0.6h-2.2l-8.2,0.1l-28.8,0.1h-0.3l0.1-0.3   c0.8-3.1,1.6-6.4,2.5-9.8c0.4-1.7,0.9-3.4,1.3-5.2l0.7-2.6l0.3-1.3l0.2-0.7l0.1-0.3v-0.2v-0.1v-0.1l0,0l0.2-0.2l39.9,0.1h0.4   l-0.1,0.2c-1.6,6.2-2.9,11.3-3.9,14.9c-0.5,1.7-0.8,3.1-1.1,4c-0.1,0.4-0.2,0.8-0.3,1S373.3,187.1,373.3,187z" />
                      <path class="st5"
                        d="M370.2,132.8c0,0.1-5.9,0.3-13.2,0.3s-13.2-0.1-13.2-0.3s5.9-0.3,13.2-0.3S370.2,132.7,370.2,132.8z" />
                      <path class="st5"
                        d="M369.9,137.1c0,0.1-6,0.3-13.3,0.3s-13.3-0.1-13.3-0.3s6-0.3,13.3-0.3S369.9,137,369.9,137.1z" />
                      <path class="st5"
                        d="M369.1,141.4c0,0.1-5.8,0.3-12.9,0.3s-12.9-0.1-12.9-0.3s5.8-0.3,12.9-0.3S369.1,141.2,369.1,141.4z" />
                      <path class="st5"
                        d="M369.6,174.5c0,0.1-5.6,0.3-12.6,0.3s-12.6-0.1-12.6-0.3s5.7-0.3,12.6-0.3S369.6,174.4,369.6,174.5z" />
                      <path class="st5"
                        d="M368,179.3c0,0.1-4.8,0.3-10.8,0.3s-10.8-0.1-10.8-0.3s4.8-0.3,10.8-0.3S368,179.1,368,179.3z" />
                      <path class="st4"
                        d="M207.1,279.8c-0.5,2.8-13.8,32.3-5.2,32.3h43.3c0,0-4.5-4.2,9.1-32.3L207.1,279.8z" />
                      <polygon class="st4" points="179.1,181.2 161.4,284.6 310.6,284.6 328.9,177.6  " />
                      <polygon class="st1" points="184.2,186.3 169.2,278.5 305.5,278.5 321.9,185.3  " />
                      <polygon class="st5"
                        points="328.9,177.6 331.7,179.5 312.7,287.4 165.3,287.4 161.4,284.6 310.6,284.6  " />
                      <path class="st3" d="M182.8,194.7c0.1-0.3,137.5-0.5,137.5-0.5l1.6-8.9l-137.8,1L182.8,194.7" />
                      <path class="st5"
                        d="M284,270.4v-0.3l0.1-0.8c0.1-0.7,0.3-1.7,0.5-3c0.5-2.7,1.1-6.5,2-11.3c1.7-9.7,4.1-23.2,6.8-38.5v-0.2h11.3   l0,0.3c-4.2,22.6-7.8,42.4-9.9,53.8v0.1h-0.1l-7.8-0.1h-2h-0.5h0.5h2.1l7.8-0.1l-0.1,0.1l9.7-53.9l0.3,0.3h-10.7l0.2-0.2   c-2.8,15.2-5.2,28.6-7,38.3c-0.9,4.8-1.6,8.7-2.1,11.4c-0.2,1.3-0.4,2.3-0.6,3.1c-0.1,0.3-0.1,0.6-0.2,0.8   C284,270.3,284,270.3,284,270.4z" />
                      <path class="st5"
                        d="M266.7,270.4c0-0.2,0.1-0.5,0.1-0.7c0.1-0.5,0.2-1.2,0.4-2.1c0.4-1.9,0.9-4.7,1.5-8c1.3-6.9,3.1-16.6,5.2-27.6   v-0.2h11.3l-0.1,0.3c-3.2,15.7-6,29.6-7.8,38.4v0.1h-0.1l-7.8-0.1h-2c-0.2,0-0.4,0-0.7,0h0.7h2.1l7.7-0.1l-0.2,0.1   c1.7-8.8,4.5-22.8,7.6-38.5l0.2,0.3h-10.8l0.2-0.2c-2.2,10.9-4.1,20.5-5.4,27.3c-0.7,3.4-1.2,6.1-1.6,8.1l-0.5,2.2   C266.9,270,266.8,270.2,266.7,270.4L266.7,270.4z" />
                      <path class="st5"
                        d="M249.4,270.4c0-0.1,0-0.2,0-0.3l0.2-1c0.1-0.9,0.4-2.1,0.6-3.8c0.6-3.3,1.4-8.1,2.5-14   c2.1-12,5.1-28.6,8.4-47.4v-0.2h11.3l0,0.3c-5.2,28.6-9.8,53.5-12.3,66.4v0.1h-0.1l-7.9-0.1h-2L249.4,270.4l0.7,0h2l7.8-0.1   l-0.1,0.1c2.3-13,6.8-37.9,12-66.5l0.3,0.3h-10.7l0.2-0.2c-3.4,18.7-6.4,35.3-8.6,47.2c-1.1,5.9-2,10.7-2.6,14l-0.7,3.8   c-0.1,0.4-0.1,0.8-0.2,1L249.4,270.4z" />
                      <path class="st5"
                        d="M232.1,270.4c0-0.2,0-0.3,0.1-0.5c0.1-0.4,0.1-0.9,0.2-1.5c0.2-1.4,0.6-3.3,1-5.7c0.9-5,2.1-11.8,3.5-19.8   v-0.2h11.2L248,243c-2.1,10.8-3.9,20.5-5.2,27.4v0.1h-0.1l-7.8-0.1l-2.1-0.1C232.5,270.4,232.3,270.4,232.1,270.4h0.7h2.1l7.7-0.1   l-0.2,0.1c1.3-6.9,3.1-16.6,5.1-27.4l0.3,0.3h-10.7l0.2-0.2c-1.5,7.9-2.8,14.6-3.7,19.5c-0.5,2.4-0.8,4.3-1.1,5.7   c-0.1,0.6-0.2,1.1-0.3,1.5C232.2,270,232.1,270.2,232.1,270.4z" />
                      <path class="st5"
                        d="M214.7,270.4c0,0,0-0.1,0-0.2s0-0.4,0.1-0.6c0.1-0.6,0.2-1.5,0.4-2.5c0.4-2.2,0.9-5.5,1.5-9.5   c1.4-8.1,3.2-19.5,5.4-32.3v-0.2h11.3l-0.1,0.3c-3.3,18.6-6.2,35.1-8,45.1v0.1h-0.1l-7.8-0.1h-2   C215.1,270.4,214.9,270.4,214.7,270.4l0.2,0.1h0.5h2.1l7.7-0.1l-0.1,0.1l7.8-45.2l0.3,0.3h-10.7l0.2-0.2c-2.2,12.8-4.2,24-5.6,32.1   c-0.7,4-1.3,7.2-1.7,9.5c-0.2,1.1-0.4,2-0.5,2.6L214.7,270.4L214.7,270.4z" />
                      <path class="st5"
                        d="M197.4,270.4c0-0.1,0-0.2,0-0.3c0-0.2,0.1-0.5,0.1-0.9c0.1-0.8,0.3-2,0.6-3.4c0.5-3,1.3-7.4,2.2-12.8   c1.9-11,4.6-26.2,7.6-43.4v-0.2h11.3l0,0.3c-4.7,25.9-8.8,48.6-11.1,60.8v0.1h-0.1l-7.9-0.1h-2h-0.5h0.5h2.1l7.8-0.1l-0.1,0.1   c2.1-12.2,6.1-34.9,10.8-60.8l0.2,0.3h-10.7l0.2-0.2c-3.1,17.2-5.8,32.3-7.7,43.2c-1,5.4-1.8,9.8-2.4,12.8   c-0.3,1.5-0.5,2.7-0.6,3.5c-0.1,0.4-0.1,0.7-0.2,0.9S197.4,270.4,197.4,270.4z" />
                      <path class="st5"
                        d="M189.9,190.4c0,0.7-0.6,1.3-1.3,1.3c-0.7,0-1.3-0.6-1.3-1.3c0-0.7,0.6-1.3,1.3-1.3c0,0,0,0,0,0   C189.3,189.2,189.9,189.7,189.9,190.4z" />
                      <circle class="st5" cx="194.9" cy="190.4" r="1.3" />
                      <path class="st5"
                        d="M202.3,190.4c0,0.7-0.6,1.3-1.3,1.3c-0.7,0-1.3-0.6-1.3-1.3c0-0.7,0.6-1.3,1.3-1.3c0,0,0,0,0,0   C201.8,189.2,202.3,189.7,202.3,190.4z" />
                      <path class="st5"
                        d="M180.1,270.4c0,0,0-0.3,0.1-0.8s0.2-1.3,0.4-2.3c0.4-2,0.8-4.9,1.4-8.5c1.3-7.3,3.1-17.5,5.1-29.2v-0.2h11.3   l-0.1,0.3c-3.1,16.7-5.8,31.4-7.6,40.7v0.1h-0.1l-7.8-0.1h-2C180.6,270.4,180.4,270.4,180.1,270.4l0.2,0.1h0.5h2.1l7.7-0.1   l-0.2,0.1l7.4-40.7l0.2,0.3h-10.8l0.2-0.2c-2.1,11.5-4,21.7-5.3,28.9c-0.7,3.6-1.2,6.5-1.6,8.6c-0.2,1-0.3,1.8-0.4,2.3L180.1,270.4   C180.2,270.3,180.1,270.3,180.1,270.4z" />
                      <polygon class="st6" points="297,229.7 239.9,229.7 243.2,210.5 300.7,210.5  " />
                      <path class="st6" d="M239.9,229.7l-1.1,6.7c0,0,7.5-7,7.4-7H240" />
                      <path class="st1"
                        d="M292.1,217.2c0,0.1-9.5,0.3-21.2,0.3s-21.2-0.1-21.2-0.3s9.5-0.3,21.2-0.3S292.1,217,292.1,217.2z" />
                      <path class="st1"
                        d="M291.5,221.8c0,0.1-9.5,0.3-21.2,0.3s-21.2-0.1-21.2-0.3s9.5-0.3,21.2-0.3S291.5,221.6,291.5,221.8z" />
                    </g>
                    <g id="Desk--inject-433">
                      <rect x="222.2" y="318.7" class="st5" width="162.6" height="94.9" />
                      <rect x="222.2" y="318.7" class="st4" width="74.1" height="94.9" />
                      <path class="st5"
                        d="M288.7,350.9c0,0,0-0.2,0-0.5s0-0.8,0-1.4c0-1.2,0-3,0-5.3c0-4.6,0-11.1-0.1-19.2l0.2,0.2l-59.6,0.1   c-0.2,0.2,0.3-0.3,0.3-0.2l0,0v6.9c0,2.3,0,4.5,0,6.7c0,4.4,0,8.7,0,12.8l-0.2-0.2l42.7,0.1l12.4,0.1h3.3h0.9L288.7,350.9   c0-0.1-0.1-0.1-0.2-0.1h-0.8h-3.3l-12.3,0.1l-42.9,0.1H229v-0.2c0-4.1,0-8.4,0-12.8v-13.4l0,0c-0.1,0,0.5-0.5,0.3-0.3l59.5,0h0.2   v0.2c0,8.1-0.1,14.8-0.1,19.4c0,2.2,0,4,0,5.2c0,0.6,0,1,0,1.4C288.8,350.6,288.8,350.8,288.7,350.9z" />
                      <path class="st5"
                        d="M261.5,337.8c0,0-0.1-0.2-0.2-0.6c-0.2-0.5-0.5-1-0.9-1.3c-0.6-0.5-1.5-0.6-2.2-0.3c-1.2,0.4-1.8,1.8-1.4,3   c0.2,0.6,0.7,1.1,1.4,1.4c0.7,0.3,1.6,0.2,2.2-0.3c0.4-0.3,0.8-0.8,0.9-1.3C261.4,338,261.5,337.8,261.5,337.8s0.1,0.2,0,0.6   c-0.1,0.6-0.4,1.1-0.9,1.5c-0.7,0.6-1.7,0.8-2.6,0.5c-1.4-0.5-2.2-2.1-1.7-3.5c0.3-0.8,0.9-1.4,1.7-1.7c0.9-0.3,1.9-0.1,2.6,0.4   c0.5,0.4,0.8,0.9,0.9,1.5C261.6,337.5,261.5,337.8,261.5,337.8z" />
                      <path class="st5"
                        d="M288.7,380c0,0,0-0.2,0-0.5s0-0.8,0-1.4c0-1.2,0-3,0-5.3c0-4.6,0-11.1-0.1-19.2l0.2,0.2l-59.6,0.1l0.3-0.3l0,0   v6.9c0,2.3,0,4.5,0,6.7c0,4.4,0,8.7,0,12.8l-0.2-0.2l42.7,0.1l12.4,0.1h3.3h0.9C288.6,379.9,288.7,379.9,288.7,380l-0.2-0.1h-0.8   h-3.3l-12.3,0.1l-42.9,0.1H229v-0.2c0-4.1,0-8.4,0-12.8v-13.4l0,0l0.3-0.3l59.6,0.1h0.2v0.2c0,8.1-0.1,14.8-0.1,19.3   c0,2.2,0,4,0,5.2c0,0.6,0,1,0,1.3C288.8,379.7,288.8,379.8,288.7,380z" />
                      <path class="st5"
                        d="M261.5,366.8c0,0-0.1-0.2-0.2-0.6c-0.2-0.5-0.5-1-0.9-1.3c-0.6-0.5-1.5-0.6-2.2-0.3c-1.2,0.4-1.8,1.8-1.4,3   c0.2,0.6,0.7,1.1,1.4,1.4c0.7,0.3,1.6,0.2,2.2-0.3c0.4-0.3,0.8-0.8,0.9-1.3C261.4,367,261.5,366.8,261.5,366.8s0.1,0.2,0,0.6   c-0.1,0.6-0.4,1.1-0.9,1.5c-0.7,0.6-1.7,0.8-2.6,0.4c-1.4-0.5-2.2-2.1-1.7-3.5c0.3-0.8,0.9-1.4,1.7-1.7c0.9-0.3,1.9-0.1,2.6,0.5   c0.5,0.4,0.8,0.9,0.9,1.5C261.6,366.5,261.5,366.8,261.5,366.8z" />
                      <path class="st5"
                        d="M288.7,409c0,0,0-0.2,0-0.5s0-0.8,0-1.4c0-1.2,0-3,0-5.3c0-4.6,0-11.1-0.1-19.2l0.2,0.2l-59.6,0.1   c-0.2,0.2,0.3-0.3,0.3-0.2l0,0v6.9c0,2.3,0,4.5,0,6.7c0,4.4,0,8.7,0,12.8l-0.2-0.2l42.7,0.1l12.4,0.1h3.3h0.9L288.7,409   c0-0.1-0.1-0.1-0.2-0.1h-0.8h-3.3l-12.3,0.1l-42.9,0.1H229v-0.2c0-4.1,0-8.4,0-12.8v-13.4l0,0c-0.1,0,0.5-0.5,0.3-0.3l59.6,0.1h0.2   v0.2c0,8.1-0.1,14.8-0.1,19.4c0,2.2,0,4,0,5.2c0,0.6,0,1,0,1.4C288.8,408.7,288.8,408.8,288.7,409z" />
                      <path class="st5"
                        d="M261.5,395.8c0,0-0.1-0.2-0.2-0.6c-0.2-0.5-0.5-1-0.9-1.3c-0.6-0.5-1.5-0.6-2.2-0.3c-1.2,0.4-1.8,1.8-1.4,3   c0.2,0.6,0.7,1.1,1.4,1.4c0.7,0.3,1.6,0.2,2.2-0.3c0.4-0.3,0.8-0.8,0.9-1.3C261.4,396,261.5,395.8,261.5,395.8s0.1,0.2,0,0.6   c-0.1,0.6-0.4,1.1-0.9,1.5c-0.7,0.6-1.7,0.7-2.6,0.4c-1.4-0.5-2.2-2.1-1.7-3.5c0.3-0.8,0.9-1.4,1.7-1.7c0.9-0.3,1.9-0.1,2.6,0.4   c0.5,0.4,0.8,0.9,0.9,1.5C261.6,395.6,261.5,395.8,261.5,395.8z" />
                      <rect x="5.2" y="318.7" class="st5" width="136.8" height="94.9" />
                      <rect y="312.1" class="st5" width="390.8" height="9" />
                      <rect x="5.2" y="321.1" class="st4" width="12.1" height="92.5" />
                    </g>
                    <g id="Character--inject-433">
                      <path class="st5"
                        d="M157.2,169.4c-0.1-0.4-0.1-0.8-0.2-1.1c-0.1-1-0.5-2-1-2.9c-0.3-0.6-0.8-1.1-1.5-1.4c-0.7-0.3-1.5-0.2-2.1,0.4   c-2.4,3-2.4,7.2,0,10.1c0.6,0.5,1.4,0.7,2.1,0.4c0.6-0.3,1.1-0.8,1.5-1.4c0.5-0.9,0.9-1.9,1-2.9C157,170.1,157.1,169.7,157.2,169.4   c0.1,0.4,0.1,0.8,0,1.2c-0.1,1.1-0.4,2.1-0.9,3.1c-0.4,0.7-0.9,1.2-1.6,1.6c-0.4,0.2-0.9,0.3-1.3,0.2c-0.5-0.1-0.9-0.3-1.3-0.6   c-2.7-3.1-2.7-7.7,0-10.9c0.4-0.3,0.8-0.5,1.3-0.6c0.4-0.1,0.9,0,1.3,0.2c0.7,0.4,1.2,0.9,1.6,1.6c0.5,1,0.8,2,0.9,3.1   C157.2,168.6,157.2,169,157.2,169.4z" />
                      <path class="st7"
                        d="M114,149.8l-3,59.9l25.7,2.4l1.4-14.6c0,0,9,2.2,11.8-6.1c1.8-5.4,3.3-47.2,3.3-47.2L114,149.8z" />
                      <path class="st5"
                        d="M158.7,150.4c-2.2,5.2-10.4,9.7-10.4,9.7l-1.4,13.3c-1.2-0.1-2.5-0.1-3.7,0c0.7-6.2-7.4-5-8.2-0.8   c-0.8,4.1,3.9,6.8,3.9,6.8c-3.2,4.9-4.5,7.5-9.1,12.1c-4.9,5-7.6,5.4-12.7,5.2l-5.6-0.3c0,0-2-4.8-3.4-16.1   c-0.7-5.4-5-12.6-3.8-21.4c3.4-25.1,31.2-20.7,31.2-20.7C146.1,130.2,163.9,138.2,158.7,150.4z" />
                      <path class="st5"
                        d="M157.2,169.4c-1.9,0.4-3.8,0.6-5.8,0.6c-1.9,0.2-3.9,0.2-5.8,0c1.9-0.4,3.8-0.5,5.8-0.6   C153.3,169.3,155.2,169.3,157.2,169.4z" />
                      <path class="st7"
                        d="M239.2,239.8l-9.4,5.8l-3.4,8v-7c0,0,2.5-3,4.6-5.2s0.6-3.7,0-4.5s-9.5,9.6-9.5,9.6v6   c-4.2-5.1-6.1-3.4-6.7-2.4s6.7,7.9,6.7,7.9v2.1l-36.7,19.7l-9.6-24l-19.7,10.3l11.8,28.5c3.1,7.6,11.8,11.2,19.4,8.1   c0.7-0.3,1.3-0.6,1.9-1l43.1-25.5l2.9-4.8c1-1.7,1.6-3.5,1.7-5.4l1.5-21.5C240.4,242.9,239.2,239.8,239.2,239.8z" />
                      <path class="st8" d="M185,279.9c-0.9,3.4-2.1,6.7-3.6,9.8C182.2,286.3,183.5,283.1,185,279.9z" />
                      <path class="st8"
                        d="M237.7,244.6c-0.6,0.3-1.1,0.5-1.7,0.8c-1.3,0.6-2.4,1.8-2.8,3.2c-0.7,2-1.7,4-2.7,5.8c0.6-2.1,1.3-4.1,2.2-6   c0.3-0.8,0.8-1.6,1.4-2.2c0.5-0.5,1.1-0.9,1.8-1.1C236.5,244.7,237.1,244.6,237.7,244.6z" />
                      <path class="st8"
                        d="M237.6,248c-0.3,0-0.6,0.2-0.8,0.5c-0.3,0.6-0.7,1.4-1,2.4c-0.4,1.2-0.8,2.4-1.3,3.5c0-1.3,0.3-2.5,0.8-3.7   c0.3-0.8,0.7-1.6,1.2-2.4c0.2-0.3,0.5-0.4,0.8-0.4C237.5,247.9,237.6,248,237.6,248z" />
                      <path class="st6"
                        d="M149.6,262.6l4.2,14.2l26.6-12c-1-3-5.4-16.2-13.8-37.2c-4.7-11.7-15.1-20.1-27.6-22.2   c-8.7-1.4-18.2-2.6-25.5-2.5c-14.9,0.1-27.7,10.7-30.7,25.3c-2.2,11.1,1.7,18.5-0.8,42.9l-0.8,61.4l71,2.6L149.6,262.6z" />
                      <path class="st6" d="M85.3,270.4c0,0-9.9,0.6-13.8-6.9c0,0,10.6-39.3,14.3-43.9L85.3,270.4z" />
                      <path class="st5"
                        d="M167.9,231.5c-0.3,0.2-0.5,0.4-0.8,0.5c-0.9,0.3-1.8,0.5-2.7,0.5c-1.5,0-2.9-0.2-4.3-0.5   c-1.6-0.4-3.5-0.9-5.5-1.3c-1.1-0.1-2.1-0.2-3.2-0.2c-1.2,0.1-2.3,0.3-3.4,0.6c-2.5,0.7-4.9,1.7-7.2,3c-2.4,1.3-4.9,2.9-7.5,4.4   c-2.7,1.7-5.6,3-8.6,4c-3.1,1-6.4,1-9.6,0.1c-2.8-0.9-5.5-2.4-7.8-4.2c-2.2-1.7-4.2-3.5-6-5.2c-1.7-1.6-3.4-3-5.3-4.3   c-2.6-2-5.7-3.3-9-3.8c-1.2-0.1-2.4-0.1-3.6,0c0.3-0.1,0.6-0.2,0.9-0.2c0.9-0.1,1.8-0.2,2.7-0.1c3.4,0.4,6.6,1.6,9.3,3.6   c1.9,1.3,3.7,2.7,5.5,4.3c1.9,1.6,3.8,3.4,6,5.1c2.2,1.8,4.8,3.1,7.5,4c3,0.8,6.1,0.7,9-0.2c2.9-1,5.8-2.3,8.4-3.9   c2.6-1.5,5.1-3.1,7.6-4.4c2.3-1.3,4.8-2.3,7.4-3c1.2-0.3,2.4-0.5,3.6-0.5c1.1,0,2.3,0.1,3.4,0.3c2.1,0.4,3.9,1,5.5,1.4   c1.4,0.4,2.8,0.6,4.2,0.7C165.5,232.1,166.7,231.9,167.9,231.5z" />
                      <path class="st5"
                        d="M150,280.5c-1.4-0.8-2.9-1.4-4.4-1.6c-1.7-0.2-3.4-0.1-5.1,0.3c-1.9,0.4-3.9,1.1-6.2,1.6   c-3.9,1-7.9,1-11.8,0.2c-3-0.7-4.6-1.6-4.6-1.8s1.8,0.5,4.7,1c3.8,0.6,7.7,0.5,11.4-0.5c2.2-0.5,4.3-1.2,6.3-1.6   c1.8-0.4,3.6-0.4,5.4-0.1c1.2,0.2,2.4,0.7,3.4,1.4C149.8,280.1,150.1,280.5,150,280.5z" />
                      <path class="st5"
                        d="M150.7,317.1c0,0-0.3,0.5-0.9,1.1c-1,0.9-2.1,1.6-3.2,2.2c-1.8,0.9-3.7,1.4-5.7,1.4c-2.4-0.1-4.8-0.6-7-1.6   c-2.3-0.9-4.5-1.9-6.5-2.5c-1.8-0.5-3.6-0.8-5.5-0.6c-1.2,0.1-2.4,0.4-3.5,1c-0.8,0.4-1.1,0.8-1.2,0.7s0.2-0.5,1-1   c1.1-0.8,2.4-1.3,3.7-1.4c2-0.2,3.9-0.1,5.8,0.5c2.2,0.7,4.4,1.5,6.6,2.5c2.1,0.9,4.3,1.4,6.6,1.6c1.8,0,3.7-0.4,5.4-1.1   C149.2,318.5,150.6,317,150.7,317.1z" />
                      <g class="st9">
                        <path
                          d="M73.7,271.1c9.3,1.9,18.9,0,28.3-0.6c5.8-0.3,12.1-1,16.7,2.6c3.6,2.8,5,7.5,6.1,12c4,16.9,4.7,32.1,5.6,49.4l-46-1    L73.7,271.1z" />
                      </g>
                      <polygon class="st10" points="85.9,239.2 87.9,267.9 81.8,267.9  " />
                      <path class="st5"
                        d="M98.8,332.4l91.3,3.2c14.8,0.5,26.5,12.8,26.3,27.6l-0.8,51.8h-33.5l-2.2-44.7l-81.1-2.1V332.4z" />
                      <rect x="120.5" y="379.8" class="st4" width="9" height="32.9" />
                      <path class="st4"
                        d="M45.1,275.4v79.2c0,10.4,8.4,18.8,18.8,18.8h52.7v-98c0-4.6-3.8-8.4-8.4-8.4H53.5   C48.9,267,45.1,270.7,45.1,275.4L45.1,275.4z" />
                      <path class="st4"
                        d="M187.6,379.8H59.2c0-7.7,6.3-13.9,14-13.9h100.6C181.4,365.8,187.7,372.1,187.6,379.8L187.6,379.8L187.6,379.8   z" />
                      <path class="st5"
                        d="M116.7,364c0.1,0.8,0,1.6-0.2,2.3c-0.9,3.6-3.8,6.4-7.5,7.1c-0.8,0.1-1.6,0.2-2.5,0.2h-2.6H92.3h-21l-6.4-0.1   h-1.7c-0.2,0-0.4,0-0.6-0.1c0.2,0,0.4,0,0.6,0l1.7,0l6.4-0.1l21-0.1h14.1c0.8,0,1.6,0,2.4-0.1c1.4-0.2,2.7-0.8,3.9-1.7   c1.7-1.2,2.9-3,3.5-5.1C116.6,364.8,116.6,364,116.7,364z" />
                      <path class="st5"
                        d="M132.8,380.1c-2.6,0.3-5.2,0.4-7.9,0.3c-2.6,0.1-5.3,0-7.9-0.3c2.6-0.3,5.3-0.3,7.9-0.3   C127.6,379.7,130.2,379.8,132.8,380.1z" />
                      <path class="st4"
                        d="M171.9,374.1c-0.1-0.3-0.2-0.7-0.2-1c-0.1-0.6-0.3-1.6-0.5-2.8c-0.4-2.5-1-6-1.6-10.4   c-0.4-2.2-0.6-4.6-1.1-7.1c-0.1-0.6-0.2-1.3-0.4-1.9s-0.4-1.3-0.6-1.9c-0.1-0.3-0.2-0.7-0.3-1s-0.2-0.6-0.4-1   c-0.3-0.7-0.5-1.3-0.8-2c-1.3-2.7-2.9-5.3-4.8-7.6c-2.1-2.5-4.5-4.7-7.2-6.5c-2.7-1.8-5.6-3.2-8.7-4.2c-2.9-0.9-5.9-1.4-8.9-1.5   c-5.8-0.1-11.1-0.1-15.5-0.2s-8-0.1-10.5-0.2c-1.2,0-2.2-0.1-2.9-0.1c-0.3,0-0.7,0-1-0.1c0.3-0.1,0.7-0.1,1-0.1l2.9-0.1   c2.5-0.1,6.1-0.1,10.5-0.2s9.7-0.1,15.6-0.1c3.1,0.1,6.2,0.6,9.2,1.5c3.2,1,6.2,2.4,9,4.3c2.8,1.9,5.3,4.1,7.4,6.7   c1.9,2.4,3.6,5.1,4.9,7.9c0.3,0.7,0.5,1.4,0.8,2c0.1,0.3,0.2,0.7,0.4,1s0.2,0.7,0.3,1c0.2,0.7,0.4,1.3,0.6,2s0.2,1.3,0.4,2   c0.4,2.6,0.7,5,1,7.2c0.6,4.4,1,8,1.3,10.4c0.1,1.2,0.2,2.2,0.3,2.8C171.9,373.3,171.9,373.7,171.9,374.1z" />
                    </g>
                  </svg>
                </div>
                <div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-file-text w-16 h-16 text-muted-foreground mx-auto mb-4" aria-hidden="true">
                    <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                    <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                    <path d="M10 9H8"></path>
                    <path d="M16 13H8"></path>
                    <path d="M16 17H8"></path>
                  </svg>
                  <p class="bold">No hay modulos instalados.</p>
                  <p>Para instalar un módulo ahora, haz click en el botón <strong>+</strong> en la parte superior.</p>
                </div>
              </div>
              <%}%>
      </main>
    </div>
  </div>

  

  <div id="uploadModal" class="modal" aria-hidden="true">
    <div class="modal__overlay" data-close></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="uploadTitle"
      aria-describedby="uploadDesc">
      <header class="modal__header"> <i data-lucide="package-plus" class="icon-16"></i>
        <div class="modal__title" id="uploadTitle">Subir módulo</div>
        <div class="modal__spacer"></div> <button class="modal__close btn btn-ghost" type="button" data-close> <i
            data-lucide="x" class="icon-16"></i> Cerrar </button>
      </header>
      <form id="uploadModuleForm" class="modal__body" method="POST" action="/api/modules/install"
        enctype="multipart/form-data" novalidate>
        <p id="uploadDesc" class="muted small" style="margin-top:-2px;margin-bottom:10px;"> Completá los campos y
          adjuntá el <strong>.zip</strong> del módulo. </p>
        <div class="field"> <label for="modName" class="label">Nombre del módulo</label> <input id="modName" name="name"
            class="input" type="text" placeholder="Ej: gestor-alumnos" minlength="3" required autocomplete="off" />
        </div>
        <div class="field"> <label for="modDesc" class="label">Pequeña descripción</label> <textarea id="modDesc"
            name="description" class="textarea" maxlength="300"
            placeholder="Breve resumen (máx. 300 caracteres)"></textarea> </div>
        <div class="field"> <label class="label">ZIP del módulo</label>
          <!-- IMPORTANTE: usamos label for="zipFile" para abrir el selector sin JS extra --> <label id="zipDrop"
            class="dropzone" for="zipFile" tabindex="0" aria-controls="zipFile"> <i data-lucide="upload"
              class="icon-20"></i>
            <div><strong>Arrastrá y soltá</strong> el .zip aquí o hacé clic para elegir</div>
            <div id="fileName" class="dropzone__hint">Acepta solo .zip</div>
          </label> <input id="zipFile" name="file" class="file-hidden" type="file"
            accept=".zip,application/zip,application/x-zip-compressed" required /> </div> <!-- Barra de progreso -->
        <div id="uploadProgress" class="progress-wrap" hidden>
          <div class="progress-track" aria-hidden="true">
            <div id="progressBar" class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"
              aria-valuenow="0"></div>
          </div>
          <div class="progress-meta"> <span><strong id="progressPct">0%</strong></span> <span id="progressBytes">0 /
              0</span> <span id="progressEta">ETA —</span> <button id="cancelUpload" type="button" class="btn btn-ghost"
              style="margin-left:auto;">Cancelar</button> </div>
        </div>
        <div class="modal__footer"> <button type="button" class="btn btn-ghost" data-close>Cancelar</button> <button
            id="submitBtn" type="submit" class="btn btn-primary">Subir módulo</button> </div>
      </form>
    </div>
  </div>

  <script>
    (() => {
      const MODULES_GRID = document.getElementById('grid-modules');

      // Cerrar todos los menús
      function closeAllMenus() {
        document.querySelectorAll('.dropdown-menu').forEach(m => m.hidden = true);
        document.querySelectorAll('.kebab-btn[aria-expanded="true"]').forEach(b => b.setAttribute('aria-expanded', 'false'));
      }

      // Toggle del menú (delegación)
      document.addEventListener('click', async (e) => {
        const btn = e.target.closest('.kebab-btn');
        if (btn) {
          const slug = btn.dataset.menuFor;
          const menu = document.getElementById('menu-' + slug);
          const isOpen = btn.getAttribute('aria-expanded') === 'true';
          closeAllMenus();
          if (!isOpen && menu) {
            menu.hidden = false;
            btn.setAttribute('aria-expanded', 'true');
          }
          return; // no seguir
        }

        // Click en eliminar
        const del = e.target.closest('.delete-module');
        if (del) {
          const slug = del.dataset.slug;
          if (!slug) return;

          const ok = confirm(`¿Eliminar el módulo "${slug}"? Esta acción no se puede deshacer.`);
          if (!ok) { closeAllMenus(); return; }

          // 1) Si el módulo está abierto en el iframe, cerralo y esperá a que quede en blanco
          const iframe = document.getElementById('modFrame');
          const isOpenInFrame = iframe && iframe.src.includes(`/modulos/${slug}`);
          if (isOpenInFrame) {
            await new Promise((resolve) => {
              const onload = () => { iframe.removeEventListener('load', onload); resolve(); };
              iframe.addEventListener('load', onload, { once: true });
              // usa el helper que ya expusimos en shell.js
              window.__closeShell ? window.__closeShell() : (iframe.src = 'about:blank');
            });
            // pequeña espera extra por si Windows tarda en soltar el lock
            await new Promise(r => setTimeout(r, 120));
          }

          del.disabled = true;
          const card = document.querySelector(`.card[data-slug="${CSS?.escape ? CSS.escape(slug) : slug}"]`);
          const sidebarCard = document.querySelector(`.avatar-modulo[data-slug="${CSS?.escape ? CSS.escape(slug) : slug}"]`);

          try {
            // Parar el modulo para poder eliminarlo
            const resStopModule = await fetch(`/api/modules/${encodeURIComponent(slug)}/stop`, {
              method: 'POST',
              headers: { 'Accept': 'application/json' },
              // credentials: 'include'
            });
            if (!resStopModule.ok) {
              const txt = await resStopModule.text().catch(() => '');
              throw new Error(txt || (`${resStopModule.status} ${resStopModule.statusText}`));
            }

            const res = await fetch(`/api/modules/${encodeURIComponent(slug)}`, {
              method: 'DELETE',
              headers: { 'Accept': 'application/json' },
              // credentials: 'include'
            });
            if (!res.ok) {
              const txt = await res.text().catch(() => '');
              throw new Error(txt || (`${res.status} ${res.statusText}`));
            }

            const modules = MODULES_GRID.getElementsByClassName('card')
            console.log(modules.length)
            if (modules.length <= 1) {
              return window.location.reload();
            }  

            card?.remove();
            sidebarCard?.remove();
            closeAllMenus();
          } catch (err) {
            alert('No se pudo eliminar: ' + (err.message || 'Error desconocido'));
            del.disabled = false;
            closeAllMenus();
          }
          return;
        }

        // Click fuera: cerrar menús
        if (!e.target.closest('.dropdown-menu')) closeAllMenus();
      });

      // Escape cierra menús
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeAllMenus();
      });

      // Si agregás cards dinámicamente, llamá otra vez:
      window.lucide && window.lucide.createIcons();
    })();
  </script>

  <script src="shell.js"></script>
  <script src="upload.js"></script>
  <script src="app.js"></script>
</body>

</html>